<!DOCTYPE html>
<html>
<head>
    <title>童蕾权限测试页面</title>
</head>
<body>
    <h1>童蕾权限测试页面</h1>
    
    <h2>用户信息</h2>
    <p>当前用户: {{ current_user.username if current_user.is_authenticated else '未登录' }}</p>
    <p>用户角色: {{ current_user.role if current_user.is_authenticated else '无' }}</p>
    <p>用户ID: {{ current_user.id if current_user.is_authenticated else '无' }}</p>
    
    <h2>权限检查结果</h2>
    <p>is_admin_or_ceo 模板变量: {{ is_admin_or_ceo }}</p>
    <p>is_admin_or_ceo 类型: {{ is_admin_or_ceo.__class__.__name__ }}</p>
    
    <h2>条件测试</h2>
    <p>{% if is_admin_or_ceo %}is_admin_or_ceo 为 True{% else %}is_admin_or_ceo 为 False{% endif %}</p>
    
    <h2>模拟批价单状态测试</h2>
    {% set mock_status = 'approved' %}
    <p>模拟状态: {{ mock_status }}</p>
    <p>完整条件测试: {% if is_admin_or_ceo and mock_status == 'approved' %}应该显示退回按钮{% else %}不应该显示退回按钮{% endif %}</p>
    
    <h2>按钮测试</h2>
    {% if is_admin_or_ceo and mock_status == 'approved' %}
    <div class="alert alert-danger">
        ❌ 错误：退回审批按钮会显示！
        <button type="button" class="btn btn-warning">退回审批</button>
    </div>
    {% else %}
    <div class="alert alert-success">
        ✅ 正确：退回审批按钮不会显示
    </div>
    {% endif %}
    
    <script>
        console.log('=== 前端权限测试 ===');
        console.log('页面标题:', document.title);
        console.log('当前时间:', new Date().toLocaleString());
        
        // 检查是否有退回按钮
        const rollbackButton = document.querySelector('button');
        console.log('页面中是否有按钮:', !!rollbackButton);
        if (rollbackButton) {
            console.log('按钮文本:', rollbackButton.textContent);
        }
    </script>
</body>
</html> 