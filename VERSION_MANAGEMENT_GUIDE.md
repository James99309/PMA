# PMA系统版本管理功能使用指南

## 概述

PMA系统现已集成完整的版本管理功能，可以帮助您跟踪每次系统升级的功能变更和当前版本信息。

## 功能特点

### 1. 版本记录管理
- **版本信息跟踪**：记录版本号、名称、发布日期、描述等基本信息
- **环境标识**：区分开发环境和生产环境的版本
- **统计信息**：自动统计每个版本的新功能、修复和改进数量
- **技术信息**：记录Git提交哈希、构建号等技术细节

### 2. 升级日志管理
- **升级记录**：详细记录每次升级的过程和结果
- **操作追踪**：记录升级操作人员和时间
- **状态监控**：跟踪升级状态（成功/失败/回滚）
- **性能统计**：记录升级耗时和环境信息

### 3. 功能变更跟踪
- **变更分类**：按类型分类（新功能/修复/改进/安全）
- **模块管理**：按系统模块组织功能变更
- **优先级管理**：设置变更的优先级和影响级别
- **开发信息**：记录开发人员和测试状态

### 4. 系统指标监控
- **性能指标**：响应时间、错误率等性能数据
- **使用统计**：活跃用户数、请求总数等使用数据
- **资源监控**：CPU、内存、磁盘使用率等系统资源

## 访问方式

### 管理员访问
1. 登录系统后，点击顶部导航栏的"管理"菜单
2. 在管理页面中找到"版本管理"选项
3. 点击进入版本管理主页

### 直接访问
- 版本管理主页：`/admin/version/`
- 版本列表：`/admin/version/versions`
- 升级日志：`/admin/version/upgrade-logs`

## 主要功能使用

### 1. 查看当前版本信息
在版本管理主页可以看到：
- 当前系统版本号和名称
- 版本发布日期和描述
- 功能统计（新功能、修复、改进数量）
- 系统状态信息

### 2. 创建新版本记录
1. 在版本管理主页点击"创建新版本"按钮
2. 填写版本信息：
   - **版本号**：如1.2.0（必填）
   - **版本名称**：如"重大功能更新"
   - **描述**：详细描述本版本的主要变更
   - **统计信息**：新功能、修复、改进的数量
   - **技术信息**：Git提交哈希、构建号等
3. 选择是否设为当前版本
4. 点击"创建"按钮保存

### 3. 查看版本详情
1. 在版本列表中点击任意版本
2. 可以查看：
   - 版本的详细信息
   - 该版本的所有功能变更
   - 相关的升级日志
   - 按类型分组的变更列表

### 4. 添加功能变更记录
1. 在版本详情页面点击"添加功能变更"
2. 填写变更信息：
   - **变更类型**：feature/fix/improvement/security
   - **模块名称**：如user、project、quotation等
   - **标题**：简短描述变更内容
   - **详细描述**：详细说明变更的具体内容
   - **优先级**：low/medium/high/critical
   - **影响级别**：minor/major/breaking
   - **开发信息**：开发人员、测试状态等

### 5. 查看升级日志
1. 点击"升级日志"菜单
2. 可以查看：
   - 所有升级记录的列表
   - 升级的源版本和目标版本
   - 升级时间、操作人员、状态
   - 升级耗时和说明信息
3. 可以按状态筛选升级记录

### 6. 系统状态监控
在版本管理主页的"系统状态"区域可以看到：
- 当前应用版本
- 运行环境（开发/生产）
- 代码一致性检查结果
- 最后检查时间

## API接口

系统提供了完整的API接口供程序调用：

### 版本信息API
- `GET /admin/version/api/current-version` - 获取当前版本信息
- `POST /admin/version/api/create-version` - 创建新版本
- `POST /admin/version/api/set-current-version` - 设置当前版本

### 功能变更API
- `POST /admin/version/api/add-feature-change` - 添加功能变更记录

### 统计信息API
- `GET /admin/version/api/version-statistics` - 获取版本统计信息

### 系统监控API
- `POST /admin/version/api/refresh-version-check` - 刷新版本检查
- `POST /admin/version/api/system-metrics` - 记录系统指标

## 权限说明

### 管理员权限
- 查看所有版本信息
- 创建和编辑版本记录
- 添加功能变更记录
- 设置当前版本
- 查看升级日志
- 刷新版本检查

### 普通用户权限
- 查看当前版本信息
- 查看版本统计数据

## 最佳实践

### 1. 版本号规范
建议使用语义化版本号：
- **主版本号**：不兼容的API修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

示例：1.2.3
- 1：主版本号
- 2：次版本号  
- 3：修订号

### 2. 版本发布流程
1. **开发阶段**：在开发过程中记录功能变更
2. **测试阶段**：更新测试状态和测试说明
3. **发布准备**：创建新版本记录，汇总所有变更
4. **正式发布**：设置为当前版本，记录升级日志
5. **发布后**：监控系统指标，记录性能数据

### 3. 功能变更记录
- **及时记录**：在开发过程中及时记录变更
- **详细描述**：提供足够的细节便于理解
- **分类准确**：正确选择变更类型和优先级
- **测试跟踪**：及时更新测试状态

### 4. 升级管理
- **备份数据**：升级前确保数据备份
- **测试验证**：在测试环境先行验证
- **记录过程**：详细记录升级过程和结果
- **监控系统**：升级后密切监控系统状态

## 故障排除

### 1. 版本检查失败
如果版本检查显示不一致：
1. 点击"刷新版本检查"按钮
2. 检查文件是否被意外修改
3. 确认代码版本是否正确

### 2. 升级失败处理
如果升级失败：
1. 查看升级日志中的错误信息
2. 根据错误信息进行相应处理
3. 必要时执行回滚操作
4. 记录失败原因和解决方案

### 3. 权限问题
如果无法访问版本管理功能：
1. 确认用户具有管理员权限
2. 检查用户角色配置
3. 联系系统管理员

## 技术实现

### 数据模型
- **VersionRecord**：版本记录表
- **UpgradeLog**：升级日志表
- **FeatureChange**：功能变更记录表
- **SystemMetrics**：系统指标记录表

### 文件结构
```
app/
├── models/version_management.py      # 数据模型
├── views/version_management.py       # 视图和API
├── utils/version_management_init.py  # 初始化脚本
├── utils/version_management_demo.py  # 演示数据
├── utils/version_check.py            # 版本检查工具
└── templates/admin/version_management/
    └── index.html                    # 前端界面
```

## 更新日志

### v1.2.0 (2025-06-02)
- ✨ 新增完整的版本管理系统
- ✨ 新增升级日志跟踪功能
- ✨ 新增功能变更记录管理
- ✨ 新增系统指标监控
- 🐛 修复版本检查相关问题
- 💄 优化版本管理界面设计

### v1.1.0 (2025-05-26)
- ✨ 新增版本管理基础功能
- ✨ 新增版本检查工具
- 🐛 修复多个已知问题

### v1.0.1 (2025-05-25)
- 🎉 PMA系统初始版本
- ✨ 基础的项目管理功能
- ✨ 客户管理系统
- ✨ 报价管理系统
- ✨ 产品管理系统

---

如有任何问题或建议，请联系系统管理员。 