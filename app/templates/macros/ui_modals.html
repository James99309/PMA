{% from 'macros/ui_helpers.html' import render_button with context %}
{% from 'macros/ui_helpers.html' import render_tree_select, render_tree_select_plugin with context %}

{% macro render_change_owner_modal(modal_id, action_url, all_users, current_owner_id, user_tree_data=None) %}
<div class="modal fade" id="{{ modal_id }}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form method="post" action="{{ action_url }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">修改项目拥有人</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="关闭"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="new_owner_id" class="form-label">选择新拥有人</label>
            {% if user_tree_data %}
              {{ render_tree_select_plugin(name="new_owner_id", tree_data=user_tree_data, selected_value=current_owner_id, required=true) }}
            {% else %}
              <select class="form-select" id="new_owner_id" name="new_owner_id" required>
                {% for user in all_users %}
                  <option value="{{ user.id }}" {% if user.id == current_owner_id %}selected{% endif %}>
                    {{ user.real_name or user.username }}（{{ user.role }}）
                  </option>
                {% endfor %}
              </select>
            {% endif %}
          </div>
        </div>
        <div class="modal-footer">
          {{ render_button('取消', type='button', color='secondary', attrs='data-bs-dismiss="modal"') }}
          {{ render_button('确认修改', type='submit', color='primary') }}
        </div>
      </div>
    </form>
  </div>
</div>
{% endmacro %} 