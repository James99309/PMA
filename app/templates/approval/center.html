{% extends "base.html" %}
{% from "macros/approval_macros.html" import approval_table, approval_filter_form with context %}

{% block title %}审批中心{% endblock %}

{% block head %}
<style>
  /* 移动端优化样式 */
  @media (max-width: 767.98px) {
    .table-responsive {
      font-size: 0.9rem;
    }
    
    .badge {
      white-space: normal;
      text-align: left;
    }
    
    .nav-pills .nav-link {
      padding: 0.5rem;
    }
    
    .filter-form .form-group {
      margin-bottom: 0.75rem;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4 pt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2 mb-0"><i class="fas fa-clipboard-check me-2"></i> 审批中心</h1>
  </div>
  
  <!-- 标签页切换 -->
  <ul class="nav nav-pills mb-4">
    <li class="nav-item">
      <a class="nav-link {{ 'active' if current_tab == 'created' else '' }}" href="{{ url_for('approval.center', tab='created') }}">
        <i class="fas fa-file-export me-1"></i> 我发起的
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link {{ 'active' if current_tab == 'pending' else '' }}" href="{{ url_for('approval.center', tab='pending') }}">
        <i class="fas fa-hourglass-half me-1"></i> 待我审批的
      </a>
    </li>
  </ul>
  
  <!-- 筛选表单 -->
  {{ approval_filter_form(current_tab, object_type, status) }}
  
  <!-- 审批列表 -->
  <div class="card">
    <div class="card-header">
      <h5 class="mb-0">
        {% if current_tab == 'created' %}
          <i class="fas fa-file-export me-2"></i> 我发起的审批
        {% else %}
          <i class="fas fa-hourglass-half me-2"></i> 待我审批的
        {% endif %}
      </h5>
    </div>
    <div class="card-body p-0">
      {{ approval_table(approvals, current_tab) }}
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // 移动端点击行跳转到详情
  document.addEventListener('DOMContentLoaded', function() {
    const tableRows = document.querySelectorAll('tbody tr');
    
    tableRows.forEach(row => {
      const link = row.querySelector('a');
      if (link) {
        const url = link.getAttribute('href');
        
        // 只在移动端启用整行点击
        if (window.innerWidth < 768) {
          row.style.cursor = 'pointer';
          row.addEventListener('click', function(e) {
            // 如果点击的是链接本身，不需要重复导航
            if (e.target.tagName === 'A' || e.target.closest('a')) {
              return;
            }
            window.location.href = url;
          });
        }
      }
    });
  });
</script>
{% endblock %} 