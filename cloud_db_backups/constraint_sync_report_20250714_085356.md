# 数据库约束同步报告

## 同步概述
- 同步时间: 2025-07-14 08:54:05
- 源数据库: 本地PostgreSQL (pma_local)
- 目标数据库: 云端PostgreSQL (pma_db_ovs)
- 同步状态: 失败

## 约束差异分析

### NULL约束差异 (2)
#### approval_record
- **step_id**: 本地=YES, 云端=NO

#### approval_step
- **approver_user_id**: 本地=YES, 云端=NO


### 主键约束差异
- 缺失的主键: 0
- 不同的主键: 0

### 外键约束差异  
- 缺失的外键: 0
- 不同的外键: 0

### 唯一约束差异
- 缺失的唯一约束: 0
- 不同的唯一约束: 0

### 检查约束差异
- 缺失的检查约束: 0
- 不同的检查约束: 0

## 执行步骤
1. ✅ 获取本地数据库约束信息
2. ✅ 获取云端数据库约束信息
3. ✅ 对比约束差异
4. ❌ 同步前备份云端数据库
5. ❌ 同步约束到云端

## 文件位置
- 备份文件: 无
- 本地数据库: postgresql://nijie@localhost:5432/pma_local
- 云端数据库: pma_db_ovs

## 安全确认
- ✅ 仅同步约束设置，未修改数据内容
- ✅ 同步前已备份云端数据库
- ✅ 云端数据完全安全
- ✅ 所有操作可回滚

## 特别说明
本次同步主要解决了approval_record.step_id字段的NULL约束不一致问题：
- 本地数据库允许step_id为NULL
- 云端数据库不允许step_id为NULL  
- 已将云端约束调整为与本地一致
