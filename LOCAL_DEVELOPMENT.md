# PMA本地开发指南

## 🔒 安全启动脚本

为了确保本地开发时不会意外连接到云端数据库，我们提供了两个安全启动脚本：

### 1. 快速启动（推荐日常使用）

```bash
./start.sh
```

**特点：**
- ✅ 自动关闭现有进程
- ✅ 自动查找可用端口（5001-5008, 8001-8003）
- ✅ 强制使用本地数据库
- ✅ 启动速度快
- ✅ 简单易用
- ✅ 智能端口冲突处理

### 1.1 超简单启动（故障排除用）

```bash
./start_simple.sh
```

**特点：**
- ✅ 最简化的启动流程
- ✅ 适合调试问题
- ✅ 快速验证环境

### 2. 完整安全启动（首次使用或故障排除）

```bash
./start_local_safe.sh
```

**特点：**
- ✅ 完整的安全检查
- ✅ 数据库连接验证
- ✅ 详细的状态报告
- ✅ 自动环境配置
- ✅ 彩色输出提示

## 🛡️ 安全机制

### 多层安全保护

1. **安全锁定文件** (`.cloud_db_locked`)
   - 只要此文件存在，系统就会拒绝云端数据库连接
   - 自动创建和维护

2. **环境变量覆盖** (`.env.local`)
   - 强制设置本地数据库连接
   - 清除所有云端数据库变量

3. **配置文件保护** (`config.py`)
   - 启动时自动检查安全锁定状态
   - 强制重定向到本地数据库

### 安全状态验证

启动时会看到以下安全提示：
```
🔒 云端数据库访问已被禁用 - 仅允许本地数据库连接
🔧 配置为使用本地数据库
💾 数据库: 本地PostgreSQL
```

## 📋 使用步骤

### 首次设置

1. **启动PostgreSQL服务**
   ```bash
   brew services start postgresql
   ```

2. **创建本地数据库**
   ```bash
   createdb pma_local
   ```

3. **运行完整安全启动**
   ```bash
   ./start_local_safe.sh
   ```

### 日常开发

直接使用快速启动：
```bash
./start.sh
```

## 🔧 故障排除

### 端口冲突
脚本会自动查找可用端口：
- 优先使用：5000-5005
- 备用端口：8000-8002

### 数据库连接问题

1. **检查PostgreSQL服务**
   ```bash
   brew services list | grep postgresql
   ```

2. **手动启动PostgreSQL**
   ```bash
   brew services start postgresql
   ```

3. **检查数据库是否存在**
   ```bash
   psql -l | grep pma_local
   ```

### 进程冲突
脚本会自动关闭现有进程，如果仍有问题：
```bash
pkill -f "run.py"
pkill -f "flask"
```

## ⚠️ 重要提醒

1. **绝对安全**：只要使用这些脚本启动，就不会连接到云端数据库
2. **数据隔离**：本地开发的所有数据修改都只影响本地数据库
3. **版本控制**：安全文件已加入`.gitignore`，不会提交到代码库

## 🚀 访问应用

启动成功后，访问：
- **本地地址**：http://localhost:端口号
- **网络地址**：http://0.0.0.0:端口号

## 📞 技术支持

如果遇到问题：
1. 检查PostgreSQL服务状态
2. 确认数据库权限
3. 查看启动日志中的错误信息
4. 使用完整安全启动进行诊断 