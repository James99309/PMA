# 项目授权编号规则设计

## 1. 设计目的

为项目管理系统中的项目提供统一、规范的授权编号生成规则，确保编号的唯一性、可读性和一致性，便于项目编号的管理和追踪。

## 2. 授权编号格式

授权编号采用如下格式：
```
{前缀}{年份}{月份}-{序号}
```

例如：`SPJ202304-001`

各部分说明：
- **前缀**：根据项目类型确定的2-3个字母标识
- **年份**：4位数字表示的年份，如2023
- **月份**：2位数字表示的月份，如01-12
- **序号**：3位数字表示的序号，从001开始，按月份递增

## 3. 项目类型与前缀映射

| 项目类型 | 前缀 | 说明 |
|---------|------|------|
| 销售重点 | SPJ | Sales Priority Project |
| 渠道跟进 | CPJ | Channel Partner Project |
| 业务机会 | APJ | Business Opportunity Project |

## 4. 授权编号生成规则

1. 确定项目类型对应的前缀
2. 获取当前年份和月份
3. 查找数据库中同类型、同年月已存在的最大序号
4. 序号在最大值基础上加1（如果没有现有编号则从001开始）
5. 按照格式组合成完整的授权编号

## 5. 实现方式

系统使用统一的授权编号生成宏（`app.utils.authorization.generate_authorization_code`）来确保所有生成的编号遵循相同的规则。该宏函数接收项目类型作为参数，返回格式化的授权编号。

```python
# 调用示例
from app.utils.authorization import generate_authorization_code

# 为一个销售重点项目生成授权编号
auth_code = generate_authorization_code('销售重点')  # 返回如 SPJ202304-001
```

## 6. 授权流程

1. 项目创建时不自动分配授权编号
2. 项目所有者或管理员可申请授权编号
3. 不同项目类型由不同角色审批：
   - 销售重点：由营销总监审批
   - 渠道跟进：由渠道经理审批
   - 业务机会：由销售经理审批
   - 管理员可以审批任何类型的项目
4. 审批通过后，系统自动生成并分配授权编号
5. 授权编号一旦分配后不可修改

## 7. 版本记录

| 版本 | 日期 | 修改人 | 变更说明 |
|------|------|-------|----------|
| 1.0  | 2025-04-18 | NIJIE | 初始版本，定义基本授权编号规则 | 