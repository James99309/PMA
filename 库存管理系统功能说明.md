# 库存管理系统功能说明

## 系统概述

库存管理系统是一个完整的库存和订单管理模块，包括库存管理、结算处理和订货管理三个主要功能模块。系统采用了标准的UI组件和权限管理，与现有PMA系统完全集成。

## 核心功能模块

### 1. 库存管理
- **库存表管理**：记录每个公司的产品库存数量
- **库存变动追踪**：完整记录所有入库、出库操作
- **库存状态监控**：支持最低库存预警和最高库存限制
- **多公司支持**：每个产品在不同公司下独立管理库存

### 2. 结算管理
- **结算处理**：从库存中扣除已结算的产品数量
- **结算单据**：生成详细的结算单据，记录结算前后的库存变化
- **结算历史**：完整保存所有结算记录和明细
- **状态跟踪**：支持待处理、已完成、已取消等状态

### 3. 订货管理
- **采购订单**：创建和管理采购订单
- **销售订单**：创建和管理销售订单
- **订单明细**：详细记录产品信息、数量、价格、折扣
- **订单状态**：草稿、已确认、已发货、已完成、已取消

## 数据库设计

### 主要数据表

1. **inventory** - 库存表
   - 记录每个公司每个产品的当前库存数量
   - 包含存储位置、预警线设置等信息

2. **inventory_transactions** - 库存变动记录表
   - 记录所有库存变动的详细信息
   - 支持入库、出库、结算、调整等操作类型

3. **settlements** - 结算表
   - 结算单主表，记录结算基本信息
   - 包含结算单号、状态、审批信息等

4. **settlement_details** - 结算明细表
   - 记录每个结算项目的详细信息
   - 包含结算前后库存数量变化

5. **purchase_orders** - 订货单表
   - 订单主表，记录订单基本信息
   - 支持采购和销售两种类型

6. **purchase_order_details** - 订货单明细表
   - 记录订单中每个产品的详细信息
   - 包含价格、折扣、总价计算

## 权限管理

### 角色权限配置
- **admin**：拥有所有权限（查看、创建、编辑、删除）
- **solution_manager**：业务管理权限（查看、创建、编辑）
- **ceo**：高级管理权限（查看、创建、编辑）
- **assistant**：只读权限（仅查看）

### 权限模块
- `inventory.view`：查看库存信息
- `inventory.create`：创建库存记录
- `inventory.edit`：编辑库存信息
- `inventory.delete`：删除库存记录

## 用户界面设计

### 1. 库存管理主页
- 统计概览：总库存项目、今日入库、低库存预警、待处理结算
- 功能模块导航：库存管理、结算管理、订货管理
- 快速操作：常用功能的快捷入口

### 2. 库存列表页面
- 搜索筛选：支持按产品名称、公司、库存状态筛选
- 库存统计：显示总项目数、正常库存、低库存预警、零库存统计
- 库存表格：详细显示所有库存信息
- 操作功能：入库、出库、库存调整等

### 3. 结算列表页面
- 结算记录管理：查看所有结算单据
- 状态筛选：按待处理、已完成、已取消状态筛选
- 结算统计：显示各状态的数量统计

### 4. 订单列表页面
- 订单管理：查看所有采购和销售订单
- 多维度筛选：按订单类型、状态、公司筛选
- 订单统计：按状态和类型的数量统计

## 技术特点

### 1. 标准化设计
- 使用标准的UI helper函数（render_button等）
- 统一的页面布局和样式
- 一致的徽章和状态显示

### 2. 业务逻辑封装
- 专用的utility函数处理库存更新
- 事务安全的结算处理
- 自动的库存数量验证

### 3. 集成性
- 与现有产品库完全集成
- 与公司管理系统集成
- 与权限管理系统集成

### 4. 扩展性
- 模块化的设计便于功能扩展
- 标准的数据模型支持业务增长
- 灵活的权限配置

## 安装和配置

### 1. 数据库初始化
```bash
python init_inventory_db.py
```

### 2. 权限配置
系统自动为各角色配置适当的权限：
- 管理员：完全权限
- 业务角色：业务操作权限
- 辅助角色：查看权限

### 3. 导航菜单
库存管理菜单已自动添加到主导航栏，有权限的用户可以直接访问。

## 访问路径

- 库存管理主页：`/inventory/`
- 库存列表：`/inventory/stock`
- 结算列表：`/inventory/settlement`
- 订单列表：`/inventory/orders`

## 核心函数

### 库存管理工具函数
- `update_inventory()`: 更新库存数量并记录变动
- `process_settlement()`: 处理库存结算
- `generate_settlement_number()`: 生成结算单号
- `generate_order_number()`: 生成订单号
- `get_inventory_status()`: 获取库存状态
- `calculate_order_totals()`: 计算订单总计

## 总结

库存管理系统提供了完整的库存和订单管理功能，采用现代化的Web界面设计，具有良好的用户体验。系统与现有PMA系统深度集成，支持多公司、多产品的复杂业务场景，为企业提供了强大的库存管理能力。

该系统的设计遵循了PMA项目的开发规范，使用了标准的UI组件和权限管理，确保了系统的一致性和可维护性。 